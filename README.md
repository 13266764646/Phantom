# ss-im

## 介绍
牛逼IM系统

## 软件架构

### 系统整体流程图
![](https://www.processon.com/view/link/5db6cb2ce4b0c5553743ab0d)

### 认证流程图

![](http://assets.processon.com/chart_image/5dc53e6ce4b005b5778bd235.png)

### 单聊流程图



### 群聊流程

1. 消息群扩散机制

### 消息timeline模型

1. 缺陷分析
2. 基于hash方案
3. 基于snowflake算法生成messageId

### zookeeper工作流程

1. 客户端获取分发系统ip地址场景：

2. 接入系统获取分发系统地址列表场景：


### 容错性分析

1. 客户端网络环境不好，挂了怎么处理

1.1 客户端挂了，接入系统会移除session、包括redis中的session。等待客户端重新连接。
1.2 在客户端挂了这段时间，分发系统发送消息的时候会发现推送不成功，此时要放入离线消息


2. 接入系统挂了怎么处理

2.1 对于分发系统来说，通过zookeeper感知到，需要移除分发系统实例。但是此时会发现有些消息推送对应的接入系统找不到了，
此时消息进入队列或者离线消息。等待客户端重新连接的时候，发起认证，更新了接入系统的地址，再将消息推送过去

2.2 对于客户端来说，分发系统挂了，则继续从zookeeper中查找下一个可用的接入系统地址，发起连接，重新认证。

3. 分发系统挂了怎么处理

3.1 对于接入系统来说，通过zookeeper感知到，需要移除分发系统的实例。


#### 参与贡献

中华石杉

